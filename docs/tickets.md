 # 実装チケット一覧（バックログ）

 本バックログは段階的実装に沿って整理しています。各チケットは小さく独立させ、受入基準を満たすまでを完了条件とします。

 ## T-01 プロジェクト雛形の作成（P0 / S）
 - 概要: ディレクトリ作成 `src/`, `tests/`, `public/`, `data/`, `logs/`, `backups/`, `scripts/`, `docs/`。
 - 受入基準: 既定ディレクトリが作成され `.gitignore` に `data/` 一時系が反映。
 - タスク: 既定構成作成 / `.gitignore` / 初期README更新。
 - 依存: なし。
 - ラベル: infra, repo。

 ## T-02 設定スキーマと `.env.example` 整備（P0 / S）
 - 概要: `.env.local` と `config.json` の項目定義、読み込みユーティリティ。
 - 受入基準: `.env.example` 提供、必須項目のバリデーションが動作。
 - タスク: スキーマ定義 / ローダ実装 / ドキュメント追記。
 - 依存: T-01。
 - ラベル: config, security。

## T-03 外部トリガーCLIの設計とPoC（P0 / M）
- 概要: たぬえさから起動されるCLIエントリ（`gacha-update`）を設計し、引数受領〜標準出力/終了コードを定義。
- 受入基準: ダミー呼び出し `gacha-update "user" 0` が成功し、ログに受領内容が記録。
- タスク: CLI骨子 / 引数受領 / ログ出力。
- 依存: T-02。
- ラベル: interface, cli。

## T-04 引数検証と正規化（P0 / M）
- 概要: `winnerName` と `hitFlag(0|1)` の妥当性検証、正規化（トリム・最大長・Unicode）。
- 受入基準: 想定外入力（空/過長/制御文字/不正フラグ）を拒否しテストを通過。
- タスク: バリデーション実装 / 単体テスト / エラーコード整理。
- 依存: T-03。
- ラベル: domain, validation, test。

## T-05 集計ドメインと重複抑止（P0 / M）
- 概要: 加算ロジック、フラグ算出（illust/gif）。短時間の同一引数連続呼び出しの抑止（デバウンス）。
- 受入基準: 2秒以内の同一呼び出しでカウントが重複加算されない（設定可能）。
- タスク: 集計器実装 / 簡易デバウンス / 単体テスト（80%+）。
- 依存: T-04。
- ラベル: domain, reliability。

 ## T-06 JSON保存とアトミック書込（P0 / S）
 - 概要: `data/current.json` への保存、テンポラリ→リネームで整合性確保。
 - 受入基準: 強制終了後もJSON破損なし、再起動で継続参照。
 - タスク: IOユーティリティ / フォーマット検証。
 - 依存: T-05。
 - ラベル: storage。

 ## T-07 表示用 `data/data.js` 生成（P0 / S）
 - 概要: `window.__GACHA_DATA__` 形式のスナップショット生成。
 - 受入基準: `users[], updatedAt` を含むJSが出力される。
 - タスク: 変換関数 / タイムスタンプ付与。
 - 依存: T-06。
 - ラベル: storage, ui。

 ## T-08 公開UI `public/index.html`（表+自動更新）（P0 / M）
 - 概要: 表示カラム（名前/当たり/大当たり/イラスト/GIF）と3–5秒毎の更新。
 - 受入基準: ローカルで `data.js` を読み表を描画し自動更新。
 - タスク: HTML/JS実装 / キャッシュバスター更新。
 - 依存: T-07。
 - ラベル: ui, obs。

 ## T-09 並び替え・フィルタ（当日/累計）（P1 / S）
 - 概要: 既定ソート（当たり降順→大当たり→名前）と当日/累計切替。
 - 受入基準: UI操作で並び替え・切替が反映。
 - タスク: クライアント側ステート管理 / ユニットテスト。
 - 依存: T-08。
 - ラベル: ui。

 ## T-10 リセット/バックアップ機能（P0 / M）
 - 概要: `backups/YYYY-MM-DD_HH-mm-ss.json` へ退避し、`current.json` 初期化。
 - 受入基準: 実行でバックアップ作成・初期化・`data.js` 更新まで完了。
 - タスク: `scripts/reset.(bat|ps1)` / バックアップ先生成。
 - 依存: T-06, T-07。
 - ラベル: ops, storage。

 ## T-11 バックアップ一覧と履歴閲覧UI（P1 / M）
 - 概要: `backups/` のスナップショット一覧を表示し選択で参照（閲覧専用）。
 - 受入基準: UIから任意の日付を選びテーブルに展開。
 - タスク: 一覧生成（`backups/index.js`）/ UI実装。
 - 依存: T-10, T-08。
 - ラベル: ui, ops。

 ## T-12 Discord Webhook通知（ON/OFF）（P1 / S）
 - 概要: 当選イベントを所定チャンネルへ通知。設定で有効/無効切替。
 - 受入基準: サンプルで通知成功、無効時は送信されない。
 - タスク: Webhook送信 / リトライ / マスクログ。
 - 依存: T-05, T-02。
 - ラベル: integration, discord, security。

## T-13 たぬえさ連携設定ガイド（P0 / S）
- 概要: たぬえさの「当選時に外部プログラム実行」設定手順（実行パス/引数の例/引用ルール）。
- 受入基準: ガイドに従いテスト実行で `gacha-update "user" 0` が成功。
- タスク: 手順書作成 / 例コマンド（BAT/PS1）/ よくあるエラー。
- 依存: T-03。
- ラベル: docs, windows。

 ## T-14 ロギング/監視・ローテーション（P1 / S）
 - 概要: `logs/app.log` 出力、サイズ/世代ローテーション、エラー通知基盤。
 - 受入基準: 規定閾値でローテ、致命時に明示ログ。
 - タスク: ロガー導入 / 設定。
 - 依存: T-03。
 - ラベル: reliability, ops。

 ## T-15 単体テスト整備（80%目標）（P0 / M）
 - 概要: パーサ/集計/保存のコアに対するテストを整備。
 - 受入基準: コアモジュール80%+、主要分岐網羅。
 - タスク: テストケース設計 / CI設定（ローカルでも可）。
 - 依存: T-04, T-05, T-06。
 - ラベル: test, quality。

 ## T-16 ドキュメント整備（README/OBS手順）（P1 / S）
 - 概要: セットアップ、起動、OBSブラウザソース設定、トラブルシュート。
 - 受入基準: 手順通りに初期セットアップ〜表示まで可能。
 - タスク: README更新 / 画像添付 / FAQ。
 - 依存: 全体。
 - ラベル: docs, ux。

 ---

 - フェーズ対応: P0=フェーズ1（MVP中核）、P1=フェーズ2以降。
 - 見積: S=~0.5日, M=~1–2日（目安）。
 - 依存関係は実装言語選定により微調整。必要なら分割/統合します。
